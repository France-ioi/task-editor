{
  "title": "Quiz",
  "type": "object",
  "description": "You can generate here a \"Quiz task\"",

  "properties": {
    "taskMetaData": {
      "type": "object",
      "title": "Task meta-data",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task; we generally use the path in the SVN.",
          "title": "id",
          "minLength": "5"
        },
        "license": {
          "type": "string",
          "title": "License",
          "enum": ["", "CC-BY-SA", "CC-BY-NC"]
        },
        "authors": {
          "type": "array",
          "title": "Authors",
          "items": {
            "type": "string"
          }
        },
        "language": {
          "type": "string",
          "description": "Language for the task. If you want to have this task in multiple languages, copy the \"index.html\" file generated by this editor to another file \"index_en.html\" (for instance), and edit it manually.",
          "enum": ["fr", "en", "de"]
        },
        "version": {
          "type": "string",
          "title": "Version"
        },
        "translators": {
          "type": "array",
          "title": "Translators",
          "items": {
            "type": "string"
            }
        },
        "graderUrl": {
          "type": "string",
          "title": "Server side grader URL"
        },
        "shuffle_questions": {
          "type": "boolean",
          "title": "Shuffle questions"
        },
        "shuffle_answers": {
          "type": "boolean",
          "title": "Shuffle answers"
        }
      },
      "required": ["id", "authors", "language"],
      "generator": [{
        "output": {
          "inject": {
            "template": "index.html",
            "selector": "$json"
          }
        }
      }]
    },
    "quiz_settings": {
      "type": "object",
      "title": "Quizz settings",
      "properties": {
        "graderUrl": {
          "type": "string",
          "title": "Server side grader URL"
        },
        "shuffle_questions": {
          "type": "boolean",
          "title": "Shuffle questions"
        },
        "shuffle_answers": {
          "type": "boolean",
          "title": "Shuffle answers"
        },
        "mathjax": {
          "type": "boolean",
          "title": "MathJax"
        }
      },
      "required": ["graderUrl"],
      "generator": [{
        "output": {
          "inject": {
            "template": "index.html",
            "selector": "$quiz_settings"
          }
        }
      }]
    },
    "title": {
      "type": "string",
      "title": "Task title",
        "generator": [{
          "output": {
            "inject": {
              "template": "index.html",
              "selector": "title"
            }
          }
        }]
    },
    "intro": {
      "title": "Statement, before questions",
      "description": "Task statement, displayed to the user before the questions.",
      "type": "multitext",
      "format": "html",
      "generator": [{
        "output": {
          "inject": {
            "template": "index.html",
            "selector": ".intro"
          }}
      }]
    },
    "questions": {
      "title": "Questions",
      "type": "array",
      "items": {
        "title": "Question",
        "oneOf": [
          { "title": "Question single choice",
            "$ref": "#/definitions/question_single" },
          { "title": "Question multiple choice",
            "$ref": "#/definitions/question_multiple" },
          { "title": "Question with input",
            "$ref": "#/definitions/question_input" }
        ]
      },
      "generator": [
        {
          "input": {
            "keepArray": true
          },
          "output": {
            "render": {
              "template": "questions.html"
            },
            "inject": {
              "template": "index.html",
              "selector": ".taskContent"
            }
          }
        },
        {
          "input": {
            "collector": "collector.js",
            "keepArray": true
          },
          "output": {
            "inject": {
              "template": "grader_data.js",
              "selector": "$window.QuizGrader.data"
            }
          }
        }
      ]
    },
    "solution": {
      "title": "Task solution",
      "type": "string",
      "format": "html",
      "options": {
        "wysiwyg": true
      },
      "generator": [{
        "output": {
          "inject": {
            "template": "index.html",
            "selector": "#solution"
          }
        }
      }]
    }
  },
  "required": ["taskMetaData", "quiz_settings", "title", "intro", "questions"],


  "definitions": {

    "question_single": {
      "title": "Question",
      "type": "object",
      "required": ["text", "answers", "correct_answer"],
      "id": "question_single",
      "properties": {
        "text": {
          "title": "Question text",
          "type": "string",
          "format": "html",
          "options": {
            "wysiwyg": true
          }
        },
        "answers": {
          "title": "Answers",
          "type": "array",
          "format": "tabs",
          "items": {
            "headerTemplate": "Answer #{{i}}",
            "type": "object",
            "required": ["text"],
            "properties": {
              "text": {
                "title": "Answer text",
                "type": "string",
                "format": "html",
                "options": {
                  "wysiwyg": true
                }
              }
            }
          }
        },
        "correct_answer": {
          "title": "Correct answer",
          "type": "string",
          "watch": {
            "answers": "question_single.answers"
          },
          "enumSource": [{
            "source": "answers",
            "title": "Answer #{{i}}",
            "value": "{{i}}"
          }]
        },
        "solution": {
          "title": "Question solution",
          "type": "string",
          "format": "html",
          "options": {
            "wysiwyg": true
          }
        }
      }
    },


    "question_multiple": {
      "title": "Question",
      "type": "object",
      "required": ["text", "answers"],
      "id": "question_multiple",
      "properties": {
        "text": {
          "title": "Question text",
          "type": "string",
          "format": "html",
          "options": {
            "wysiwyg": true
          }
        },
        "answers": {
          "title": "Answers",
          "type": "array",
          "format": "tabs",
          "items": {
            "headerTemplate": "Answer #{{i}}",
            "type": "object",
            "required": ["text", "correct"],
            "properties": {
              "text": {
                "title": "Answer text",
                "type": "string",
                "format": "html",
                "options": {
                  "wysiwyg": true
                }
              },
              "correct": {
                "title": "Correct answer",
                "type": "boolean"
              }
            }
          }
        },
        "solution": {
          "title": "Question solution",
          "type": "string",
          "format": "html",
          "options": {
            "wysiwyg": true
          }
        }
      }
    },

    "question_input": {
      "title": "Question",
      "type": "object",
      "required": ["text", "correct_answer", "format", "validator"],
      "properties": {
        "text": {
          "title": "Question text",
          "type": "string",
          "format": "html",
          "options": {
            "wysiwyg": true
          }
        },
        "format": {
          "title": "Answer input format",
          "description": "This controls the client-side validation of the answer, and will display a warning to the user if their answer is not in the expected format. Do not use it to check the answer!",
          "type": "string",
          "enum": ["string", "number", "regexp"]
        },
        "validator": {
          "title": "Answer input validator regexp (optional param for regexp input type)",
          "description": "RegExps are interpreted by JavaScript. Enter it either as a string which will be passed to the RegExp constructor (^ab+$), either as a RegExp in JS syntax (/^ab+$/i).",
          "type": "string"
        },
        "correct_answer": {
          "title": "Correct answer",
          "type": "object",
          "required": ["type", "value"],
          "properties": {
            "type": {
              "title": "Type",
              "type": "string",
              "enum": ["value", "function"]
            },
            "value": {
              "title": "Value or JS function (according to selected type)",
              "description": "If function is selected, enter a function which takes as sole argument the user's answer, and returns either a boolean which is true if the answer is right, either an object {valid: [boolean], message: [string]} to display a message to the user.",
              "type": "string",
              "format": "textarea",
              "options": {
                "input_height": "100px"
              }
            }
          }
        },
        "solution": {
          "title": "Question solution",
          "type": "string",
          "format": "html",
          "options": {
            "wysiwyg": true
          }
        }
      }
    }
  }
}
